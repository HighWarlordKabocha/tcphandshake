<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TCP Three-Way Handshake</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background:#0f172a; color:#e2e8f0; }
    header { padding: 16px 20px; border-bottom: 1px solid rgba(226,232,240,.15); }
    main { display: grid; grid-template-columns: 1fr 1.2fr 1fr; gap: 16px; padding: 16px; }

    .panel { background:#111827; border:1px solid rgba(226,232,240,.15); border-radius: 12px; padding: 14px; }
    .panel h2 { margin: 0 0 8px; font-size: 16px; color:#93c5fd; }

    .lane { min-height: 420px; display:flex; flex-direction:column; gap: 18px; }
    .step { display:grid; grid-template-columns: 1fr 120px 1fr; align-items:center; gap: 10px; }
    .arrow { text-align:center; font-size: 18px; opacity: .95; user-select:none; }

    .pillRow {
      grid-column: 1 / -1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 10px 0;
      border-radius: 12px;
      background: rgba(148,163,184,.06);
      border: 1px solid rgba(226,232,240,.12);
    }

    .slotPill {
      min-width: 110px;
      min-height: 42px;
      background: rgba(148,163,184,.08);
      border: 1px dashed rgba(226,232,240,.35);
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      color: rgba(226,232,240,.65);
      padding: 4px 12px;
      font-weight: 700;
      user-select:none;
      transition: all .15s ease;
    }

    /* NEW: stronger indicator when filled */
    .slotPill.filled {
      border-style: solid;
      border-color: rgba(226,232,240,.55);
      background: rgba(148,163,184,.14);
      color: #e2e8f0;
    }

    .slotPill.good { border-color: rgba(34,197,94,.6); background: rgba(34,197,94,.12); color:#bbf7d0; }
    .slotPill.bad  { border-color: rgba(239,68,68,.7); background: rgba(239,68,68,.12); color:#fecaca; }

    .hyphen { opacity:.7; font-weight:900; }

    .tray { display:flex; flex-wrap:wrap; gap: 10px; margin-top: 10px; }
    .card {
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,.18);
      background: rgba(59,130,246,.18);
      cursor: grab;
      user-select:none;
      font-weight: 800;
      letter-spacing: .3px;
    }
    .card:active { cursor: grabbing; }
    .card.used { opacity: .35; pointer-events:none; }

    .controls { display:flex; gap: 10px; margin-top: 10px; }
    button {
      border: 1px solid rgba(226,232,240,.2);
      background: rgba(226,232,240,.08);
      color:#e2e8f0;
      padding: 10px 12px;
      border-radius: 10px;
      cursor:pointer;
      font-weight: 700;
    }
    button:hover { background: rgba(226,232,240,.12); }

    .hint { font-size: 13px; opacity:.85; margin-top: 8px; line-height: 1.35; }
    .hint h3 { margin: 10px 0 4px; font-size: 14px; color:#cbd5e1; }
    .ok  { color:#86efac; }
    .no  { color:#fca5a5; }
    .muted { opacity:.75; }

    @media (max-width: 1050px) {
      main { grid-template-columns: 1fr; }
      .lane { min-height: auto; }
    }
  </style>
</head>
<body>
<header>
  <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
    <div>
      <div style="font-weight:900; font-size:18px;">TCP Three-Way Handshake</div>
      <div class="muted" style="font-size:13px;">Drag the TCP flag cards into the lane to form a valid handshake.</div>
    </div>
    <div id="status" style="font-weight:900;"></div>
  </div>
</header>

<main>
  <!-- LEFT PANEL -->
  <section class="panel">
    <h2>TCP Connections</h2>
    <div class="hint">
      <h3>TCP Connections</h3>
      TCP is a communication method that computers use to reliably send data over a network.
      Before data can be sent, a connection must first be established.

      <h3>The TCP Three-Way Handshake</h3>
      To start a connection, TCP uses a process called the three-way handshake.
      This is a short exchange of packets between a client and a server that confirms both sides are ready to communicate.

      Each packet contains special control flags that describe its purpose.

      <h3>Your Challenge</h3>
      Your task is to complete the three-way handshake by dragging and dropping the correct control flag cards into each step.
      Arrange the cards so the connection is properly established.

      <h3>Check Your Work</h3>
      Click <b>Check</b> to see if your answer is correct.
      Click <b>Reset</b> to try again.
    </div>

    <div class="controls">
      <button id="resetBtn">Reset</button>
      <button id="checkBtn">Check</button>
    </div>
  </section>

  <!-- HANDSHAKE LANE -->
  <section class="panel lane">

    <!-- Step 1 -->
    <div class="step">
      <div style="text-align:right; opacity:.85;">Client</div>
      <div class="arrow">‚Üí</div>
      <div style="opacity:.85;">Server</div>

      <div class="pillRow">
        <div class="slotPill" data-accept="SYN">Drop</div>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="step">
      <div style="text-align:right; opacity:.85;">Client</div>
      <div class="arrow">‚Üê</div>
      <div style="opacity:.85;">Server</div>

      <div class="pillRow">
        <div class="slotPill" data-accept="SYN">Drop</div>
        <div class="hyphen">-</div>
        <div class="slotPill" data-accept="ACK">Drop</div>
      </div>
    </div>

    <!-- Step 3 -->
    <div class="step">
      <div style="text-align:right; opacity:.85;">Client</div>
      <div class="arrow">‚Üí</div>
      <div style="opacity:.85;">Server</div>

      <div class="pillRow">
        <div class="slotPill" data-accept="ACK">Drop</div>
      </div>
    </div>

  </section>

  <!-- CARDS -->
  <section class="panel">
    <h2>Cards</h2>
    <div class="hint muted">You may not need every card.</div>

    <div class="tray">
      <div class="card" draggable="true" data-msg="SYN" data-cardid="syn1">SYN</div>
      <div class="card" draggable="true" data-msg="SYN" data-cardid="syn2">SYN</div>
      <div class="card" draggable="true" data-msg="ACK" data-cardid="ack1">ACK</div>
      <div class="card" draggable="true" data-msg="ACK" data-cardid="ack2">ACK</div>
      <div class="card" draggable="true" data-msg="RST" data-cardid="rst1">RST</div>
      <div class="card" draggable="true" data-msg="FIN" data-cardid="fin1">FIN</div>
    </div>
  </section>
</main>

<script>
  const statusEl = document.getElementById("status");
  const cards = [...document.querySelectorAll(".card")];
  const slots = [...document.querySelectorAll(".slotPill")];

  const FLAG_B64 = "RkxBR3tTM0NSM1RfSDRORDVINEszfQ==";

  function setStatus(text, cls) {
    statusEl.textContent = text || "";
    statusEl.className = cls || "";
  }

  let dragged = { msg: null, cardId: null };

  cards.forEach(card => {
    card.addEventListener("dragstart", (e) => {
      dragged.msg = card.dataset.msg;
      dragged.cardId = card.dataset.cardid;
      e.dataTransfer.setData("text/plain", JSON.stringify(dragged));
    });
  });

  function getDragPayload(e) {
    try {
      return JSON.parse(e.dataTransfer.getData("text/plain"));
    } catch {
      return dragged;
    }
  }

  function markCardUsed(cardId, used) {
    const card = document.querySelector(`.card[data-cardid="${cardId}"]`);
    if (!card) return;
    card.classList.toggle("used", !!used);
  }

  function allowDrop(el) {
    el.addEventListener("dragover", (e) => e.preventDefault());
  }

  function validateSlot(slot) {
    const accept = slot.dataset.accept;
    const got = slot.dataset.filledMsg;

    slot.classList.remove("good", "bad");

    if (!got) return false;

    if (got === accept) {
      slot.classList.add("good");
      return true;
    } else {
      slot.classList.add("bad");
      return false;
    }
  }

  slots.forEach(slot => {
    allowDrop(slot);

    slot.addEventListener("drop", (e) => {
      e.preventDefault();
      const payload = getDragPayload(e);
      if (!payload) return;

      if (slot.dataset.filledCardId) {
        markCardUsed(slot.dataset.filledCardId, false);
      }

      slot.dataset.filledMsg = payload.msg;
      slot.dataset.filledCardId = payload.cardId;
      slot.textContent = payload.msg;

      markCardUsed(payload.cardId, true);

      slot.classList.add("filled");   // üî• NEW VISUAL INDICATOR
      slot.classList.remove("good", "bad");

      setStatus("", "");
    });
  });

  function checkAll() {
    const allFilled = slots.every(s => s.dataset.filledMsg);

    if (!allFilled) {
      setStatus("Some steps are still empty.", "no");
      return;
    }

    const allCorrect = slots.map(validateSlot).every(Boolean);

    if (allCorrect) {
      const flag = atob(FLAG_B64);
      setStatus(`Connection ESTABLISHED ‚úÖ Here's your flag: ${flag}`, "ok");
    } else {
      setStatus("Connection NOT established ‚ùå Try again.", "no");
    }
  }

  function resetAll() {
    slots.forEach(slot => {
      slot.classList.remove("good", "bad", "filled"); // üî• remove filled state
      if (slot.dataset.filledCardId) markCardUsed(slot.dataset.filledCardId, false);
      delete slot.dataset.filledMsg;
      delete slot.dataset.filledCardId;
      slot.textContent = "Drop";
    });

    cards.forEach(c => c.classList.remove("used"));
    setStatus("", "");
  }

  document.getElementById("checkBtn").addEventListener("click", checkAll);
  document.getElementById("resetBtn").addEventListener("click", resetAll);

  resetAll();
</script>
</body>
</html>
